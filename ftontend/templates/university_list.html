{% extends "base.html" %}
{% load static %}

{% block title %}Каталог университетов — NeXus{% endblock %}

{% block extra_head %}
<style>
  .university-card {
    border: 1px solid var(--bg-secondary);
    border-radius: 1.25rem;
    background: #fff;
    box-shadow: 0 10px 30px rgba(28, 28, 30, 0.06);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .university-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 40px rgba(28, 28, 30, 0.1);
  }

  .university-card .accent-bar {
    height: 6px;
    background: linear-gradient(90deg, var(--accent-color), var(--accent-soft));
  }

  .university-card .city-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.35rem 0.85rem;
    border-radius: 999px;
    background: var(--accent-soft);
    color: var(--accent-color);
    font-weight: 600;
    font-size: 0.9rem;
  }

  .university-card .cta-button {
    background: var(--accent-color);
    color: #fff;
    font-weight: 700;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.08);
  }

  .university-card .cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 30px rgba(0, 0, 0, 0.1);
    filter: brightness(0.92);
  }
</style>
{% endblock %}


{% block content %}
<section class="bg-white border-b border-[var(--bg-secondary)]">
  <div class="max-w-7xl mx-auto px-6 py-12 space-y-8">
    <div>
      <h1 class="text-3xl md:text-4xl font-bold mb-6">Подборка университетов</h1>
      <p class="text-secondary text-base md:text-lg max-w-3xl">
        Выберите университет, чтобы познакомиться с программами, инфраструктурой и возможностями для студентов.
        Мы подготовили краткое описание для быстрого выбора и подробные страницы с детальной информацией.
      </p>
    </div>

    <form method="get" class="flex flex-col md:flex-row gap-4 md:items-end">
      <label class="flex flex-col text-sm font-medium text-secondary gap-2">
        Город
        <select name="city" onchange="this.form.submit()" class="rounded-xl border border-[var(--bg-secondary)] px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-primary)]">
          <option value="all" {% if selected_city == 'all' %}selected{% endif %}>Все города</option>
          {% for city in cities %}
          <option value="{{ city }}" {% if selected_city == city %}selected{% endif %}>{{ city }}</option>
          {% endfor %}
        </select>
      </label>
      {% if selected_city != 'all' %}
      <a href="?" class="text-sm text-[var(--brand-primary)] hover:underline">Сбросить фильтр</a>
      {% endif %}
    </form>
  </div>
</section>

<section class="max-w-7xl mx-auto px-6 py-12 grid gap-8 sm:grid-cols-2 xl:grid-cols-3">
  {% for university in page_obj %}
  <article class="university-card overflow-hidden flex flex-col" style="--accent-color: {{ university.brand_color|default:'#6C4DFF' }}; --accent-soft: {{ university.brand_color_soft|default:'rgba(108, 77, 255, 0.12)' }};">
    <div class="accent-bar" aria-hidden="true"></div>
    <div class="h-48 overflow-hidden">
      <img src="{{ university.image }}" alt="{{ university.title }}" class="w-full h-full object-cover" />
    </div>
    <div class="p-6 flex-1 flex flex-col gap-3">
      <div class="flex items-start justify-between gap-3">
        <h2 class="text-xl font-semibold leading-tight">{{ university.title }}</h2>
        <span class="city-pill">{{ university.city }}</span>
      </div>
      <p class="text-secondary text-sm flex-1">{{ university.description }}</p>
      <a href="{% url 'university_detail' university.slug %}" class="cta-button inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl">
        Подробнее
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7-7 7" />
        </svg>
      </a>
    </div>
  </article>
  {% empty %}
  <p class="text-secondary">Список университетов временно недоступен. Попробуйте обновить страницу позже.</p>
  {% endfor %}
</section>

{% if page_obj.paginator.num_pages > 1 %}
<div class="max-w-7xl mx-auto px-6 pb-12">
  <nav class="flex flex-wrap items-center justify-center gap-3" aria-label="Пагинация">
    {% if page_obj.has_previous %}
    <a href="?{% if selected_city != 'all' %}city={{ selected_city }}&amp;{% endif %}page={{ page_obj.previous_page_number }}" class="px-4 py-2 rounded-xl border border-[var(--bg-secondary)] text-sm font-medium text-secondary hover:text-[var(--brand-primary)]">Назад</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
    {% if page_obj.number == num %}
    <span class="px-4 py-2 rounded-xl bg-[var(--brand-primary)] text-white text-sm font-semibold">{{ num }}</span>
    {% else %}
    <a href="?{% if selected_city != 'all' %}city={{ selected_city }}&amp;{% endif %}page={{ num }}" class="px-4 py-2 rounded-xl border border-[var(--bg-secondary)] text-sm font-medium text-secondary hover:text-[var(--brand-primary)]">{{ num }}</a>
    {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
    <a href="?{% if selected_city != 'all' %}city={{ selected_city }}&amp;{% endif %}page={{ page_obj.next_page_number }}" class="px-4 py-2 rounded-xl border border-[var(--bg-secondary)] text-sm font-medium text-secondary hover:text-[var(--brand-primary)]">Вперёд</a>
    {% endif %}
  </nav>
</div>
{% endif %}
{% endblock %}